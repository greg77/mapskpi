<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      html, body { height: 100%; margin: 0; padding: 0; }
      #map { height: 100%; }
    </style>
  </head>

  <body>
    <div id="map"></div>
    <script src="./js/jquery.js"></script>
    <script type="text/javascript" async>
var lato;
var longo;

var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : sParameterName[1];
        }
    }
};


var map;
function initMap() {
  var listFail = getUrlParameter('fail');
  alert(listFail);
 var listFailArr = listFail.split("|");
 var bounds = new google.maps.LatLngBounds();
 console.log(listFailArr);
  //alert(lato);
  //alert(longo);
  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 45.750000, lng: 4.850000},
    zoom: 8
  });
  
//  alert('plop');
var listFailArr_count = listFailArr.length;
alert('taille: '+listFailArr_count);
for (var i = 0; i < listFailArr_count; i++) {
    fail = listFailArr[i];
    locArr = fail.split(",");
    lato= parseFloat(locArr[0]);
    longo= parseFloat(locArr[1]);
    alert('location:'+lato+' '+longo);
    addMarker("fail",lato,longo,"12h13");
    bounds.extend(new google.maps.LatLng(lato, longo));
 
}
map.fitBounds(bounds);
}

function addMarker(type,lat,long,heure) {
   pinColor = "FE7569";
   customTitre = "";
   
    if (new String(type).valueOf() == new String("fail").valueOf()){
        pinColor = "FF0000";
        customTitre =  'Failure';
    }else if (new String(type).valueOf() == new String("drop").valueOf()){
        pinColor = "FF00FF";
        customTitre =  'Drop Call';
    }else if (new String(type).valueOf() == new String("srvcc_ok").valueOf()){
        pinColor = "00FF00";
        customTitre =  'SRVCC Success';
    }else if (new String(type).valueOf() == new String("srvcc_nok").valueOf()){
        pinColor = "FFFF00";
        customTitre =  'SRVCC Failure';
    }else if (new String(type).valueOf() == new String("csfb_3G").valueOf()){
        pinColor = "1E90FF";
        customTitre =  'CSFallback to 3G';
    }else if (new String(type).valueOf() == new String("csfb_2G").valueOf()){
        pinColor = "00FFFF";
        customTitre =  'CSFallback to 2G';
    }
    
   pinImage = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|" + pinColor,
   new google.maps.Size(21, 34),
    new google.maps.Point(0,0),
    new google.maps.Point(10, 34));
    
   marker = new google.maps.Marker({
        position: new google.maps.LatLng(lat, long),
        map: map,
        icon: pinImage,
        title: customTitre
      });
  infowindow = new google.maps.InfoWindow();   
  google.maps.event.addListener(marker, 'click', function() {
            infowindow.setContent("<b>"+customTitre+" at "+heure+"</b><br />Latitude: "+lat+"<br />Longitude: "+long);
            infowindow.open(map, this);
          });
}

    </script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDA6fTTJgYVEjmG01er3s3MNAtxVuWETqw&callback=initMap">
    </script>
  </body>
</html>